<HTML><HEAD>
<TITLE>October 1993/Exception Handling in C/Listing 3</TITLE></HEAD>

<BODY BACKGROUND="" BGCOLOR="#FFFFFF" TEXT="#000000">

<h4><A NAME="heading1">Listing 3 <I>The </I>UNWIND_PROTECT<I> macro</I></A></h4>
<pre>FILE *volatile file = NULL;
static int no_such_file;
static int read_failed;

UNWIND_PROTECT(
{
  int i;
  
  file = fopen("data", "r");
  if (file == NULL)
    THROW(no_such_file);
  
  if (fscanf(file, "%d", &amp;i) != 1)
    THROW(read_failed);
  
  printf("%d\n", i);
},
{
  if (file)
    fclose(file);
});

/* End of File */
</pre>
</BODY>
</HTML>
