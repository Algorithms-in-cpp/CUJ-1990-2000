<HTML><HEAD>
<TITLE>March 1994/Weight Reduction Techniques in C++/Figure 6</TITLE></HEAD>

<BODY BACKGROUND="" BGCOLOR="#FFFFFF" TEXT="#000000">

<h4><A NAME="heading1">Figure 6<I> Implementing copy on write</A></I></h4>
<pre>class String {

// the contents of the string
// class from <A href="fig5.htm">Figure 5</a>.


...

// this indexing operator could
// modify the string
  char &amp;operator[](int i)
  {
    if(imp-&gt;count &gt; 1)
      Split();
    return imp-&gt;ptr[i];
  }
// This indexing operator won't
// modify, don't split.
  char operator[](int i) const
  {
    return imp-&gt;ptr[i];
  }
private:
  void Split()
  {
// Create private copy:
    imp-&gt;count--;
    imp = new
      StringImp(imp-&gt;ptr);
  }
};
// End of File</pre>
</BODY>
</HTML>
