<HTML><HEAD>
<TITLE>August 1992/Standard C/Listing 3</TITLE></HEAD>

<BODY BACKGROUND="" BGCOLOR="#FFFFFF" TEXT="#000000">

<h4><A NAME="heading1">Listing 3 (exit.c)</A></h4>
<pre>                    /* exit function */
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include "yfuns.h"

                          /* macros */
#define NATS 32
                      /* static data */
void (*_Atfuns[NATS])(void) = {0};
size_t _Atcount = {NATS};

void (exit)(int status)
   {      /* tidy up and exit to system */
   while (_Atcount &lt; NATS)
      (*_Atfuns [_Atcount++]) ();
    {                /* close all files */
   size_t i;

   for (i = 0; i &lt; FOPEN_MAX; ++i)
      if (_Files[i])
         fclose(_Files[i]);
   }
   _Exit(status);
   }
/* End of File */
</pre>
</BODY>
</HTML>
