<HTML>
<HEAD>

<TITLE>February 1990/Dealing With Memory Allocation Problems</TITLE></HEAD>
<body bgcolor="#ffffff">
<H2><A HREF="../tocfeb.htm"><IMG SRC="../../toc.gif" ALT="{back to toc}" WIDTH="54" HEIGHT="54"></A><FONT COLOR="#FF0000">   Features</FONT></H2>

<hr><h2 align="center"><font color="#800000">Dealing With Memory Allocation Problems<A name="0061_0034"><A name="0061_0034"></font></h2><HR>
<BLOCKQUOTE>
<A name="0061_0000"><A name="0061_0000">Dear Mr. Ward:<P>
I am not much of a letter writer, but after reading the July 89 issue of <I>The C Users Journal</I> I felt I could save some of your readers a lot of time tracking down a problem with the Microsoft C, version 5.10 memory allocation routines. Enclosed is a listing and the output from the program.<P>
This may help Steven Isaacson who is having memory allocation problems using Vitamin C. I found this problem after a week of tracking down a memory leak problem in a very large application. My final solution was to write my own <I>malloc()/free()</I> rountines that call DOS directly. This will let the DOS allocator do what is is supposed to do. No time penalty was noticed in our application.</FONT></FONT><P>
Note if you do write your own <I>malloc()/free()</I> routines, call them something else! MSC uses these routines internally and makes assumptions about what data is located outside the allocated area. I always use a <I>malloc()/free()</I> shell to test for things like memory leaks and the free of a non-allocated block. It also will give you an easy way to install a global 'out of memory' error handler.</FONT></FONT></FONT></FONT><P>
The code supplied by Leonard Zerman on finding the amount of free space in a system is simplistic and very limited. A better routine would build a linked list of elements and then the variable <I>vptrarray</I> could be made a single pointer to the head of the list. The entire routine becomes dynamic, much more robust, and there is no danger of overflowing a statically allocated array. See the supplied code for an example.</FONT></FONT><P>
The linked list implementation has the side effect that it will work on a virtual memory system. Why you would want to do this is beyond me, but it could be considered a very time consuming way to find out what <I>swapmax</I> is set to on a UNIX system.</FONT></FONT><P>
If you have any questions, please contact me. My phone number is (408) 988-3818. My fax number is (408) 748-1424.<P>
Sincerely yours,<P>
Jim Schimandle<br>
Primary Syncretics<br>
473 Sapena Court, Unit #6<br>
Santa Clara, CA 95054<P>
Editor's Note:<P>
<I>If you couldn't find "<A href="list1.htm">Listing 1</A>" in last month's "We Have Mail", you needn't fear the onset of any perceptual disorder &#151; there was no <A HREF="list1.htm">Listing 1</A>.
 Usually publishers blame this kind of problem on someone else &#151; the printer, the typesetter, the proofreader, the paste-up artist. Unfortunately this publisher doesn't have any convenient scapegoats; I pasted up the letters section (something I often do), and failed to include the listing.</I><P>
<I>Anyway, here is the original letter and the promised listing. This time it will be right &#151; my staff is doing it.</I><P>
<I>&#151;rlw</I><P>
</BLOCKQUOTE>
</BODY>
</HTML>
