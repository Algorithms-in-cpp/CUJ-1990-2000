<HTML><HEAD>
<TITLE>October 1999/Singleton Creation the Thread-safe Way/Listing 2</TITLE></HEAD>

<BODY BACKGROUND="" BGCOLOR="#FFFFFF" TEXT="#000000">

<h4><A NAME="heading1">Listing 2:	A common singleton implementation</A></h4>
<pre>
//try1.h
class Singleton
{
public:
   static Singleton&amp; instance();
   void show_state();

protected:
   Singleton();

private:
   static Singleton* _instance;
   int state;
};

Singleton* Singleton::_instance = NULL;

Singleton&amp; Singleton::instance()
{
   if(!_instance) // Race condition exists here
      _instance = new Singleton;

   return *_instance;
}


</pre>
</BODY>
</HTML>
