<HTML><HEAD>
<TITLE>July 1994/Code Capsules/Listing 9</TITLE></HEAD>

<BODY BACKGROUND="" BGCOLOR="#FFFFFF" TEXT="#000000">

<h4><A NAME="heading1">Listing 9 <I>Illustrates the principle of "resource allocation is initialization"</A></I></h4>
<pre>//destroy5.cpp
#include &lt;stdio.h&gt;

void f(char *fname);

main()
{
   try
   {
      f("file1.dat");
   }
   catch(...)
   {
      puts("Exception caught in
          main()");
   }
   return 0;
{

void f(char *fname)
{
   class File
   {
      FILE *f;
   public:
      File(const char* fname,
          const char* mode)
      {
         f = fopen(fname, mode);
      }
      ~File()
      {
         fclose(f);
         puts("File closed");
      }
   };
   
   File x(fname,"r");
   throw 1;
}

/* Output:
File closed
Exception caught in main()
*/

// End of File
</pre>
</BODY>
</HTML>
